@model IEnumerable<Sito.Models.Product>

@{
    ViewBag.Title = "Prodotti";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Prodotti</h2>

@Html.ValidationSummary(false, "", new { @class = "text-danger" })

@{ Sito.ServiceReference2.User curruser = (Sito.ServiceReference2.User)Session[Client.Controllers.HomeController.active_user];}
@if (curruser != null && curruser.admin)
{
    <div>
        @using (Html.BeginForm())
        {
            <input type="button" class="button1" value="Aggiungi Prodotto" onclick="@("location.href='" + Url.Action("AddProduct", "Home") + "'")" />
        }
    </div>
    <br />
}

@if (Model.Count() > 0)
{
    <div>
        @using (Html.BeginForm())
        {
            <input type="submit" class="button1" value="Aggiungi al Carrello" onclick="@("location.href='" + Url.Action("Cart", "Home") + "'")" />
            <input type="submit" class="button1" value="Acquista" onclick="@("location.href='" + Url.Action("Buy", "Home") + "'")" />
        }
    </div>
    <br />
    <div class="container-fluid">
        <div class="row">
            @foreach (Sito.Models.Product item in Model)
            {
                <div class="col-lg-3">
                    <a href="@Url.Action("ProductDetails", "Home", new { id = item.product_id })">
                        <img src="@item.img_url" style="width: 256px; height: 256px;" />
                    </a>
                    <br />

                    @{string title = $"{item.brand} {item.model}";}
                    <a class="h1" href="@Url.Action("ProductDetails", "Home", new { id = item.product_id })"><b>@title</b></a>

                    <div class="h4">@item.price €</div>

                    @{string pz = "pezzi", dsp = "disponibili";}
                    @if (item.quantity == 1)
                    {
                        pz = "pezzo";
                        dsp = "disponibile";
                    }
                    <div class="h4">@item.quantity @pz @dsp</div>

                    <div class="h4">
                        Quantità:
                        <input type="number" min="0" max="@item.quantity" value="@item.selected" />
                    </div>
                </div>
            }
        </div>
    </div>

    int page = (int)TempData[Client.Controllers.HomeController.current_page];
    <nav>
        <ul class="pagination">
            @if ((bool)TempData[Client.Controllers.HomeController.has_prev_page])
            {
                <li class="page-item">
                    @Html.ActionLink("«", "Products", "Home", new { page = page - 2 }, new { @class = "page-link" })
                </li>
            }
            else
            {
                <li class="page-item disabled">
                    <span class="page-link">&laquo;</span>
                </li>
            }

            <li class="page-item"><span class="page-link">@page</span></li>
            @if ((bool)TempData[Client.Controllers.HomeController.has_next_page])
            {
                <li class="page-item">
                    @Html.ActionLink("»", "Products", "Home", new { page = page }, new { @class = "page-link" })
                </li>
            }
            else
            {
                <li class="page-item disabled">
                    <span class="page-link">&raquo;</span>
                </li>
            }
        </ul>
    </nav>

}